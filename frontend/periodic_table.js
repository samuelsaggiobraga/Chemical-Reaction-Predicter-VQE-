const elements=[{symbol:'H',name:'Hydrogen',number:1,row:1,col:1},{symbol:'He',name:'Helium',number:2,row:1,col:18},{symbol:'Li',name:'Lithium',number:3,row:2,col:1},{symbol:'Be',name:'Beryllium',number:4,row:2,col:2},{symbol:'B',name:'Boron',number:5,row:2,col:13},{symbol:'C',name:'Carbon',number:6,row:2,col:14},{symbol:'N',name:'Nitrogen',number:7,row:2,col:15},{symbol:'O',name:'Oxygen',number:8,row:2,col:16},{symbol:'F',name:'Fluorine',number:9,row:2,col:17},{symbol:'Ne',name:'Neon',number:10,row:2,col:18},{symbol:'Na',name:'Sodium',number:11,row:3,col:1},{symbol:'Mg',name:'Magnesium',number:12,row:3,col:2},{symbol:'Al',name:'Aluminum',number:13,row:3,col:13},{symbol:'Si',name:'Silicon',number:14,row:3,col:14},{symbol:'P',name:'Phosphorus',number:15,row:3,col:15},{symbol:'S',name:'Sulfur',number:16,row:3,col:16},{symbol:'Cl',name:'Chlorine',number:17,row:3,col:17},{symbol:'Ar',name:'Argon',number:18,row:3,col:18},{symbol:'K',name:'Potassium',number:19,row:4,col:1},{symbol:'Ca',name:'Calcium',number:20,row:4,col:2},{symbol:'Sc',name:'Scandium',number:21,row:4,col:3},{symbol:'Ti',name:'Titanium',number:22,row:4,col:4},{symbol:'V',name:'Vanadium',number:23,row:4,col:5},{symbol:'Cr',name:'Chromium',number:24,row:4,col:6},{symbol:'Mn',name:'Manganese',number:25,row:4,col:7},{symbol:'Fe',name:'Iron',number:26,row:4,col:8},{symbol:'Co',name:'Cobalt',number:27,row:4,col:9},{symbol:'Ni',name:'Nickel',number:28,row:4,col:10},{symbol:'Cu',name:'Copper',number:29,row:4,col:11},{symbol:'Zn',name:'Zinc',number:30,row:4,col:12},{symbol:'Ga',name:'Gallium',number:31,row:4,col:13},{symbol:'Ge',name:'Germanium',number:32,row:4,col:14},{symbol:'As',name:'Arsenic',number:33,row:4,col:15},{symbol:'Se',name:'Selenium',number:34,row:4,col:16},{symbol:'Br',name:'Bromine',number:35,row:4,col:17},{symbol:'Kr',name:'Krypton',number:36,row:4,col:18},{symbol:'Rb',name:'Rubidium',number:37,row:5,col:1},{symbol:'Sr',name:'Strontium',number:38,row:5,col:2},{symbol:'Y',name:'Yttrium',number:39,row:5,col:3},{symbol:'Zr',name:'Zirconium',number:40,row:5,col:4},{symbol:'Nb',name:'Niobium',number:41,row:5,col:5},{symbol:'Mo',name:'Molybdenum',number:42,row:5,col:6},{symbol:'Tc',name:'Technetium',number:43,row:5,col:7},{symbol:'Ru',name:'Ruthenium',number:44,row:5,col:8},{symbol:'Rh',name:'Rhodium',number:45,row:5,col:9},{symbol:'Pd',name:'Palladium',number:46,row:5,col:10},{symbol:'Ag',name:'Silver',number:47,row:5,col:11},{symbol:'Cd',name:'Cadmium',number:48,row:5,col:12},{symbol:'In',name:'Indium',number:49,row:5,col:13},{symbol:'Sn',name:'Tin',number:50,row:5,col:14},{symbol:'Sb',name:'Antimony',number:51,row:5,col:15},{symbol:'Te',name:'Tellurium',number:52,row:5,col:16},{symbol:'I',name:'Iodine',number:53,row:5,col:17},{symbol:'Xe',name:'Xenon',number:54,row:5,col:18},{symbol:'Cs',name:'Cesium',number:55,row:6,col:1},{symbol:'Ba',name:'Barium',number:56,row:6,col:2},{symbol:'Hf',name:'Hafnium',number:72,row:6,col:4},{symbol:'Ta',name:'Tantalum',number:73,row:6,col:5},{symbol:'W',name:'Tungsten',number:74,row:6,col:6},{symbol:'Re',name:'Rhenium',number:75,row:6,col:7},{symbol:'Os',name:'Osmium',number:76,row:6,col:8},{symbol:'Ir',name:'Iridium',number:77,row:6,col:9},{symbol:'Pt',name:'Platinum',number:78,row:6,col:10},{symbol:'Au',name:'Gold',number:79,row:6,col:11},{symbol:'Hg',name:'Mercury',number:80,row:6,col:12},{symbol:'Tl',name:'Thallium',number:81,row:6,col:13},{symbol:'Pb',name:'Lead',number:82,row:6,col:14},{symbol:'Bi',name:'Bismuth',number:83,row:6,col:15},{symbol:'Po',name:'Polonium',number:84,row:6,col:16},{symbol:'At',name:'Astatine',number:85,row:6,col:17},{symbol:'Rn',name:'Radon',number:86,row:6,col:18},{symbol:'Fr',name:'Francium',number:87,row:7,col:1},{symbol:'Ra',name:'Radium',number:88,row:7,col:2},{symbol:'Rf',name:'Rutherfordium',number:104,row:7,col:4},{symbol:'Db',name:'Dubnium',number:105,row:7,col:5},{symbol:'Sg',name:'Seaborgium',number:106,row:7,col:6},{symbol:'Bh',name:'Bohrium',number:107,row:7,col:7},{symbol:'Hs',name:'Hassium',number:108,row:7,col:8},{symbol:'Mt',name:'Meitnerium',number:109,row:7,col:9},{symbol:'Ds',name:'Darmstadtium',number:110,row:7,col:10},{symbol:'Rg',name:'Roentgenium',number:111,row:7,col:11},{symbol:'Cn',name:'Copernicium',number:112,row:7,col:12},{symbol:'Nh',name:'Nihonium',number:113,row:7,col:13},{symbol:'Fl',name:'Flerovium',number:114,row:7,col:14},{symbol:'Mc',name:'Moscovium',number:115,row:7,col:15},{symbol:'Lv',name:'Livermorium',number:116,row:7,col:16},{symbol:'Ts',name:'Tennessine',number:117,row:7,col:17},{symbol:'Og',name:'Oganesson',number:118,row:7,col:18}];
const lanthanides=[{symbol:'La',name:'Lanthanum',number:57},{symbol:'Ce',name:'Cerium',number:58},{symbol:'Pr',name:'Praseodymium',number:59},{symbol:'Nd',name:'Neodymium',number:60},{symbol:'Pm',name:'Promethium',number:61},{symbol:'Sm',name:'Samarium',number:62},{symbol:'Eu',name:'Europium',number:63},{symbol:'Gd',name:'Gadolinium',number:64},{symbol:'Tb',name:'Terbium',number:65},{symbol:'Dy',name:'Dysprosium',number:66},{symbol:'Ho',name:'Holmium',number:67},{symbol:'Er',name:'Erbium',number:68},{symbol:'Tm',name:'Thulium',number:69},{symbol:'Yb',name:'Ytterbium',number:70},{symbol:'Lu',name:'Lutetium',number:71}];
const actinides=[{symbol:'Ac',name:'Actinium',number:89},{symbol:'Th',name:'Thorium',number:90},{symbol:'Pa',name:'Protactinium',number:91},{symbol:'U',name:'Uranium',number:92},{symbol:'Np',name:'Neptunium',number:93},{symbol:'Pu',name:'Plutonium',number:94},{symbol:'Am',name:'Americium',number:95},{symbol:'Cm',name:'Curium',number:96},{symbol:'Bk',name:'Berkelium',number:97},{symbol:'Cf',name:'Californium',number:98},{symbol:'Es',name:'Einsteinium',number:99},{symbol:'Fm',name:'Fermium',number:100},{symbol:'Md',name:'Mendelevium',number:101},{symbol:'No',name:'Nobelium',number:102},{symbol:'Lr',name:'Lawrencium',number:103}];
let selectedElements={};
function initPeriodicTable(){buildTable('periodicTable',elements,true);buildTable('lanthanides',lanthanides,false);buildTable('actinides',actinides,false);}
function buildTable(id,list,grid){const t=document.getElementById(id);if(grid){const g=Array(7).fill().map(()=>Array(18).fill(null));list.forEach(e=>{g[e.row-1][e.col-1]=e;});g.forEach((r,ri)=>{r.forEach((e,ci)=>{if(e)t.appendChild(createElementDiv(e,ci+1,ri+1));});});}else{list.forEach((e,i)=>{t.appendChild(createElementDiv(e,i+1,1));});}}
function createElementDiv(e,col,row){const d=document.createElement('div');d.className='element';d.id=`elem-${e.symbol}`;d.innerHTML=`<div class="element-count" id="count-${e.symbol}" style="display:none;">0</div><div class="element-number">${e.number}</div><div class="element-symbol">${e.symbol}</div><div class="element-name">${e.name}</div>`;d.style.gridColumn=col;d.style.gridRow=row;d.onclick=()=>addElement(e.symbol);d.oncontextmenu=(ev)=>{ev.preventDefault();removeElement(e.symbol);};return d;}
function addElement(s){if(!selectedElements[s])selectedElements[s]=0;selectedElements[s]++;updateElementDisplay(s);updateSelectedDisplay();}
function removeElement(s){if(selectedElements[s]&&selectedElements[s]>0){selectedElements[s]--;if(selectedElements[s]===0)delete selectedElements[s];updateElementDisplay(s);updateSelectedDisplay();}}
function updateElementDisplay(s){const e=document.getElementById(`elem-${s}`);const c=document.getElementById(`count-${s}`);const cnt=selectedElements[s]||0;if(cnt>0){e.classList.add('selected');c.style.display='block';c.textContent=cnt;}else{e.classList.remove('selected');c.style.display='none';}}
function updateSelectedDisplay(){const d=document.getElementById('selectedElements');if(Object.keys(selectedElements).length===0){d.textContent='None';}else{const p=Object.entries(selectedElements).map(([s,c])=>c>1?`${s}${c}`:s);d.textContent=p.join(' + ');}}
function clearSelection(){Object.keys(selectedElements).forEach(s=>{selectedElements[s]=0;updateElementDisplay(s);});selectedElements={};updateSelectedDisplay();}
async function predictReaction(){if(Object.keys(selectedElements).length===0){alert('Please select at least one element');return;}const arr=[];Object.entries(selectedElements).forEach(([s,c])=>{for(let i=0;i<c;i++)arr.push(s);});document.getElementById('resultsSection').classList.add('show');document.getElementById('loadingState').style.display='block';document.getElementById('resultsContent').style.display='none';const l=document.getElementById('loadingState');l.innerHTML=`<div class="loading-spinner"></div><p style="font-size:1.1rem;">Running quantum calculations...</p><p style="font-size:0.85rem;color:#8a8a8a;margin-top:10px;">Step 1/3: Building Hamiltonian</p>`;try{setTimeout(()=>{l.innerHTML=`<div class="loading-spinner"></div><p style="font-size:1.1rem;">Running VQE optimization...</p><p style="font-size:0.85rem;color:#8a8a8a;margin-top:10px;">Step 2/3: MATLAB computation (5-20s)</p>`;},2000);const r=await fetch('http://localhost:5001/api/predict-reaction',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({elements:arr})});if(!r.ok){const e=await r.json();throw new Error(e.error||`HTTP ${r.status}`);}const d=await r.json();if(!d.success)throw new Error(d.error||'Prediction failed');document.getElementById('loadingState').style.display='none';document.getElementById('resultsContent').style.display='block';displayResults(d);}catch(e){l.innerHTML=`<div style="padding:20px;text-align:left;"><p style="color:#aa6a6a;font-size:1.1rem;">⚠ Error</p><p style="color:#8a8a8a;margin:10px 0;">${e.message}</p><p style="color:#6a6a6a;font-size:0.85rem;margin-top:15px;">Troubleshooting:</p><ul style="color:#6a6a6a;font-size:0.85rem;margin-left:20px;"><li>Ensure server is running (python backend/api/server.py)</li><li>Check MATLAB installation</li><li>Verify Gemini API key in config/.env</li></ul></div>`;}}
function displayResults(d){const q=document.getElementById('quantumDataTable');q.innerHTML=`<tr><td>VQE Energy</td><td>${d.quantum_data.vqe_energy?.toFixed(6)||'N/A'}</td><td>Hartree</td></tr><tr><td>HF Energy</td><td>${d.quantum_data.hf_energy?.toFixed(6)||'N/A'}</td><td>Hartree</td></tr><tr><td>Improvement</td><td>${d.quantum_data.energy_improvement?.toFixed(6)||'N/A'}</td><td>Hartree</td></tr><tr><td>Electrons</td><td>${d.quantum_data.num_electrons||'N/A'}</td><td>—</td></tr><tr><td>Qubits</td><td>${d.quantum_data.num_qubits||'N/A'}</td><td>—</td></tr>`;const p=document.getElementById('productsContainer');p.innerHTML=d.ai_prediction.products.map(pr=>`<div class="product-card"><div class="product-formula">${pr.formula}</div><div style="color:#a0a0a0;margin:5px 0;">${pr.name}</div><div style="color:#8a8a8a;font-size:0.85rem;font-family:'IBM Plex Mono',monospace;">Probability: ${(pr.probability*100).toFixed(1)}%</div></div>`).join('');document.getElementById('mechanismText').textContent=d.ai_prediction.mechanism||'Not provided';document.getElementById('thermodynamicsText').textContent=d.ai_prediction.thermodynamics||'Not provided';const v=d.ai_prediction.validation;if(v){const vc=document.getElementById('validationContainer');const sc=v.result==='LIKELY_CORRECT'?'correct':v.result==='UNCERTAIN'?'warning':'error';vc.innerHTML=`<div class="validation-box ${sc}"><div style="font-family:'IBM Plex Mono',monospace;font-weight:600;margin-bottom:10px;text-transform:uppercase;">${v.result.replace(/_/g,' ')}</div><div style="font-size:0.85rem;color:#8a8a8a;line-height:1.6;"><p><strong>Confidence:</strong> ${(v.confidence*100).toFixed(1)}%</p><p><strong>Checks:</strong> ${v.checks_passed}</p><p><strong>Recommendation:</strong> ${v.recommendation}</p>${v.warnings.length>0?`<p style="margin-top:10px;"><strong>Warnings:</strong></p><ul style="margin-left:20px;">${v.warnings.map(w=>`<li>${w}</li>`).join('')}</ul>`:''}</div></div>`;}}
initPeriodicTable();
